version: "3.5"

services:
  
  prometheus:
    image: prom/prometheus
    container_name: prometheus
    ports:
     - 9090:9090
    volumes:
      - "./prometheus.yml:/etc/prometheus/prometheus.yml"
    command:
      - '--config.file=/home/alex/py/prometheus/prometheus.yml'
      
  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - 3000:3000
    restart: unless-stopped
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=grafana
    volumes:
      - ./grafana:/etc/grafana/provisioning/datasources
  
  mysql:
    image: mysql:latest
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_DATABASE: "test_db"
    network_mode: "host"
    volumes:
      - ./data/mysqldata:/var/lib/docker/volumes/mysql_data/_data
    
  rabbitmq:
    image: rabbitmq:3-management
    network_mode: "host"

  client:
    image: flask-client
    depends_on: 
      - rabbitmq
    network_mode: "host"
  
  server:
    image: flask-server
    depends_on:
     - client
 
